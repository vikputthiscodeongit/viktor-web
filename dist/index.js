document.body;const t=t=>Array.isArray(t),e=e=>t(e)?e:[e],i="data-typeit-id",n="ti-cursor",r={started:!1,completed:!1,frozen:!1,destroyed:!1},s={breakLines:!0,cursor:{autoPause:!0,autoPauseDelay:500,animation:{frames:[0,0,1].map((t=>({opacity:t}))),options:{iterations:1/0,easing:"steps(2, start)",fill:"forwards"}}},cursorChar:"|",cursorSpeed:1e3,deleteSpeed:null,html:!0,lifeLike:!0,loop:!1,loopDelay:750,nextStringDelay:750,speed:100,startDelay:250,startDelete:!1,strings:[],waitUntilVisible:!1,beforeString:()=>{},afterString:()=>{},beforeStep:()=>{},afterStep:()=>{},afterComplete:()=>{}},o=`[${i}]:before {content: '.'; display: inline-block; width: 0; visibility: hidden;}`,a=t=>document.createElement(t),l=t=>document.createTextNode(t),u=(t,e="")=>{let i=a("style");i.id=e,i.appendChild(l(t)),document.head.appendChild(i)},d=e=>(t(e)||(e=[e/2,e/2]),e),c=(t,e)=>Math.abs(Math.random()*(t+e-(t-e))+(t-e));let h=t=>t/2;const p=t=>Array.from(t);let m=t=>([...t.childNodes].forEach((t=>{if(t.nodeValue)return[...t.nodeValue].forEach((e=>{t.parentNode.insertBefore(l(e),t)})),void t.remove();m(t)})),t);const f=t=>{let e=document.implementation.createHTMLDocument();return e.body.innerHTML=t,m(e.body)};function y(t,e=!1,i=!1){let r,s=t.querySelector(`.${n}`),o=document.createTreeWalker(t,NodeFilter.SHOW_ALL,{acceptNode:t=>{if(s&&i){if(t.classList?.contains(n))return NodeFilter.FILTER_ACCEPT;if(s.contains(t))return NodeFilter.FILTER_REJECT}return t.classList?.contains(n)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),a=[];for(;r=o.nextNode();)r.originalParent||(r.originalParent=r.parentNode),a.push(r);return e?a.reverse():a}const b=({index:t,newIndex:e,queueItems:i,cleanUp:n})=>{for(let r=t+1;r<e+1;r++)n(i[r][0])},E=t=>Number.isInteger(t),v=({queueItems:t,selector:e,cursorPosition:i,to:n})=>{if(E(e))return-1*e;let r=new RegExp("END","i").test(n),s=e?[...t].reverse().findIndex((({char:t})=>{let i=t.parentElement,n=i.matches(e);return!(!r||!n)||n&&i.firstChild.isSameNode(t)})):-1;return s<0&&(s=r?0:t.length-1),s-i+(r?0:1)},g=(t,e)=>new Array(e).fill(t);let w=t=>new Promise((e=>{requestAnimationFrame((async()=>{e(await t())}))})),I=t=>t?.getAnimations().find((e=>e.id===t.dataset.tiAnimationId)),A=({cursor:t,frames:e,options:i})=>{let n=t.animate(e,i);return n.pause(),n.id=t.dataset.tiAnimationId,w((()=>{w((()=>{n.play()}))})),n},C=t=>t.func?.call(null);const S=t=>"value"in t;let x=t=>"function"==typeof t?t():t,T=(t,e=document,i=!1)=>e["querySelector"+(i?"All":"")](t);const O=(t,e)=>Object.assign({},t,e);let N={"font-family":"","font-weight":"","font-size":"","font-style":"","line-height":"",color:"",transform:"translateX(-.125em)"};class P{element;timeouts;cursorPosition;predictedCursorPosition;statuses={started:!1,completed:!1,frozen:!1,destroyed:!1,firing:!1};opts;id;queue;cursor;flushCallback=null;unfreeze=()=>{};constructor(t,i={}){var n;this.opts=O(s,i),this.element="string"==typeof(n=t)?T(n):n,this.timeouts=[],this.cursorPosition=0,this.unfreeze=()=>{},this.predictedCursorPosition=null,this.statuses=O({},r),this.id=Math.random().toString().substring(2,9),this.queue=function(t){let i=function(t){return e(t).forEach((t=>o.set(Symbol(t.char?.innerText),n({...t})))),this},n=t=>(t.shouldPauseCursor=function(){return Boolean(this.typeable||this.cursorable||this.deletable)},t),r=()=>o,s=()=>Array.from(o.values()),o=new Map;return i(t),{add:i,set:function(t,e){let i=[...o.keys()];o.set(i[t],n(e))},wipe:function(){o=new Map,i(t)},done:(t,e=!1)=>e?o.delete(t):o.get(t).done=!0,reset:function(){o.forEach((t=>delete t.done))},destroy:t=>o.delete(t),getItems:(t=!1)=>t?s():s().filter((t=>!t.done)),getQueue:r,getTypeable:()=>s().filter((t=>t.typeable)),getPendingQueueItems:()=>{const t=[];for(let[,e]of r())e.done||t.push(e);return t}}}([{delay:this.opts.startDelay}]),this.#t(i),this.cursor=this.#e(),this.element.dataset.typeitId=this.id,u(o),this.opts.strings.length&&this.#i()}go(){return this.statuses.started?this:(this.#n(),this.opts.waitUntilVisible?(t=this.element,e=this.#r.bind(this),new IntersectionObserver(((i,n)=>{i.forEach((i=>{i.isIntersecting&&(e(),n.unobserve(t))}))}),{threshold:1}).observe(t),this):(this.#r(),this));var t,e}destroy(t=!0){this.timeouts=(this.timeouts.forEach(clearTimeout),[]),x(t)&&this.cursor&&this.#s(this.cursor),this.statuses.destroyed=!0}reset(t){!this.is("destroyed")&&this.destroy(),t?(this.queue.wipe(),t(this)):this.queue.reset(),this.cursorPosition=0;for(let t in this.statuses)this.statuses[t]=!1;return this.element[this.#o()?"value":"innerHTML"]="",this}is=function(t){return this.statuses[t]};type(t,e={}){t=x(t);let{instant:i}=e,n=this.#a(e),r=function(t,e=!0){return e?y(f(t)):p(t).map(l)}(t,this.opts.html).map((t=>{return{func:()=>this.#l(t),char:t,delay:i||(e=t,/<(.+)>(.*?)<\/(.+)>/.test(e.outerHTML))?0:this.#u(),typeable:t.nodeType===Node.TEXT_NODE};var e})),s=[n[0],{func:async()=>await this.opts.beforeString(t,this)},...r,{func:async()=>await this.opts.afterString(t,this)},n[1]];return this.#d(s,e)}break(t={}){return this.#d({func:()=>this.#l(a("BR")),typeable:!0},t)}move(t,e={}){t=x(t);let i=this.#a(e),{instant:n,to:r}=e,s=v({queueItems:this.queue.getTypeable(),selector:null===t?"":t,to:r,cursorPosition:this.#c}),o=s<0?-1:1;return this.predictedCursorPosition=this.#c+s,this.#d([i[0],...g({func:()=>this.#h(o),delay:n?0:this.#u(),cursorable:!0},Math.abs(s)),i[1]],e)}exec(t,e={}){let i=this.#a(e);return this.#d([i[0],{func:()=>t(this)},i[1]],e)}options(t,e={}){return t=x(t),this.#p(t),this.#d({},e)}pause(t,e={}){return this.#d({delay:x(t)},e)}delete(t=null,e={}){t=x(t);let i=this.#a(e),n=t,{instant:r,to:s}=e,o=this.queue.getTypeable(),a=(()=>null===n?o.length:E(n)?n:v({queueItems:o,selector:n,cursorPosition:this.#c,to:s}))();return this.#d([i[0],...g({func:this.#m.bind(this),delay:r?0:this.#u(1),deletable:!0},a),i[1]],e)}freeze(){this.statuses.frozen=!0}flush(t=null){return this.flushCallback=t||this.flushCallback,this.statuses.firing||(this.#n(),this.#r(!1).then((()=>{if(this.queue.getPendingQueueItems().length>0)return this.flush();this.flushCallback(),this.flushCallback=null}))),this}getQueue(){return this.queue}getOptions(){return this.opts}updateOptions(t){return this.#p(t)}getElement(){return this.element}empty(t={}){return this.#d({func:this.#f.bind(this)},t)}async#f(){this.#o()?this.element.value="":this.#y.forEach(this.#s.bind(this))}async#r(t=!0){this.statuses.started=!0,this.statuses.firing=!0;let e=e=>{this.queue.done(e,!t)};try{let i=[...this.queue.getQueue()];for(let t=0;t<i.length;t++){let[n,r]=i[t];if(!r.done){if(!r.deletable||r.deletable&&this.#y.length){let n=await this.#b(t,i);b({index:t,newIndex:n,queueItems:i,cleanUp:e}),t=n}e(n)}}if(!t)return this.statuses.firing=!1,this;if(this.statuses.completed=!0,this.statuses.firing=!1,await this.opts.afterComplete(this),!this.opts.loop)throw"";let n=this.opts.loopDelay;this.#E((async()=>{await this.#v(n[0]),this.#r()}),n[1])}catch(t){}return this.statuses.firing=!1,this}async#h(t){var e,i,r;this.cursorPosition=(e=t,i=this.cursorPosition,r=this.#y,Math.min(Math.max(i+e,0),r.length)),(t=>{let e=this.#y[this.cursorPosition-1],i=T(`.${n}`,t);(t=e?.parentNode||t).insertBefore(i,e||null)})(this.element)}async#v(t){let e=this.#c;e&&await this.#h({value:e});let i=this.#y.map((t=>[Symbol(),{func:this.#m.bind(this),delay:this.#u(1),deletable:!0,shouldPauseCursor:()=>!0}]));for(let t=0;t<i.length;t++)await this.#b(t,i);this.queue.reset(),this.queue.set(0,{delay:t})}#b(t,e){return(async({index:t,queueItems:e,wait:i,cursor:n,cursorOptions:r})=>{let s=e[t][1],o=[],a=t,l=s,u=()=>l&&!l.delay,d=s.shouldPauseCursor()&&r.autoPause;for(;u();)o.push(l),u()&&a++,l=e[a]?e[a][1]:null;if(o.length)return await w((async()=>{for(let t of o)await C(t)})),a-1;let c,h=I(n);return h&&(c={...h.effect.getComputedTiming(),delay:d?r.autoPauseDelay:0}),await i((async()=>{h&&d&&h.cancel(),await w((()=>{C(s)}))}),s.delay),await(({cursor:t,options:e,cursorOptions:i})=>{if(!t||!i)return;let n,r=I(t);r&&(e.delay=r.effect.getComputedTiming().delay,n=r.currentTime,r.cancel());let s=A({cursor:t,frames:i.animation.frames,options:e});return n&&(s.currentTime=n),s})({cursor:n,options:c,cursorOptions:r}),t})({index:t,queueItems:e,wait:this.#E.bind(this),cursor:this.cursor,cursorOptions:this.opts.cursor})}async#E(t,e,i=!1){this.statuses.frozen&&await new Promise((t=>{this.unfreeze=()=>{this.statuses.frozen=!1,t()}})),i||await this.opts.beforeStep(this),await((t,e,i)=>new Promise((n=>{i.push(setTimeout((async()=>{await t(),n()}),e||0))})))(t,e,this.timeouts),i||await this.opts.afterStep(this)}async#n(){if(!this.#o()&&this.cursor&&this.element.appendChild(this.cursor),this.#g){((t,e)=>{let r=`[${i}='${t}'] .${n}`,s=getComputedStyle(e),o=Object.entries(N).reduce(((t,[e,i])=>`${t} ${e}: var(--ti-cursor-${e}, ${i||s[e]});`),"");u(`${r} { display: inline-block; width: 0; ${o} }`,t)})(this.id,this.element),this.cursor.dataset.tiAnimationId=this.id;let{animation:t}=this.opts.cursor,{frames:e,options:r}=t;A({frames:e,cursor:this.cursor,options:{duration:this.opts.cursorSpeed,...r}})}}#o(){return S(this.element)}#d(t,e){return this.queue.add(t),this.#w(e),this}#w(t={}){let e=t.delay;e&&this.queue.add({delay:e})}#a(t={}){return[{func:()=>this.#p(t)},{func:()=>this.#p(this.opts)}]}async#p(t){this.opts=O(this.opts,t)}#i(){let t=this.opts.strings.filter((t=>!!t));t.forEach(((e,i)=>{if(this.type(e),i+1===t.length)return;let n=this.opts.breakLines?[{func:()=>this.#l(a("BR")),typeable:!0}]:g({func:this.#m.bind(this),delay:this.#u(1)},this.queue.getTypeable().length);this.#I(n)}))}#t=t=>{this.opts.cursor=(t=>{if("object"==typeof t){let e={},{frames:i,options:n}=s.cursor.animation;return e.animation=t.animation||{},e.animation.frames=t.animation?.frames||i,e.animation.options=O(n,t.animation?.options||{}),e.autoPause=t.autoPause??s.cursor.autoPause,e.autoPauseDelay=t.autoPauseDelay||s.cursor.autoPauseDelay,e}return!0===t?s.cursor:t})(t.cursor??s.cursor),this.opts.strings=this.#A(e(this.opts.strings)),this.opts=O(this.opts,{html:!this.#C&&this.opts.html,nextStringDelay:d(this.opts.nextStringDelay),loopDelay:d(this.opts.loopDelay)})};#A(t){let e=this.element.innerHTML;return e?(this.element.innerHTML="",this.opts.startDelete?(this.element.innerHTML=e,m(this.element),this.#I(g({func:this.#m.bind(this),delay:this.#u(1),deletable:!0},this.#y.length)),t):(i=e,i.replace(/<!--(.+?)-->/g,"").trim().split(/<br(?:\s*?)(?:\/)?>/)).concat(t)):t;var i}#e(){if(this.#C)return null;let t=a("span");return t.className=n,this.#g?(t.innerHTML=f(this.opts.cursorChar).innerHTML,t):(t.style.visibility="hidden",t)}#I(t){let e=this.opts.nextStringDelay;this.queue.add([{delay:e[0]},...t,{delay:e[1]}])}#l(t){((t,e)=>{if(S(t))return void(t.value=`${t.value}${e.textContent}`);e.innerHTML="";let i=(r=e.originalParent,/body/i.test(r?.tagName)?t:e.originalParent||t);var r;let s=T("."+n,i)||null;s&&s.parentElement!==i&&(i=s.parentElement),i.insertBefore(e,s)})(this.element,t)}#m(){this.#y.length&&(this.#C?this.element.value=this.element.value.slice(0,-1):this.#s(this.#y[this.cursorPosition]))}#s(t){((t,e)=>{if(!t)return;let i=t.parentNode;(i.childNodes.length>1||i.isSameNode(e)?t:i).remove()})(t,this.element)}#u(t=0){return function(t){let{speed:e,deleteSpeed:i,lifeLike:n}=t;return i=null!==i?i:e/3,n?[c(e,h(e)),c(i,h(i))]:[e,i]}(this.opts)[t]}get#c(){return this.predictedCursorPosition??this.cursorPosition}get#C(){return S(this.element)}get#g(){return!!this.opts.cursor&&!this.#C}get#y(){return t=this.element,S(t)?p(t.value):y(t,!0).filter((t=>!(t.childNodes.length>0)));var t}}function q(t,e){if("string"!=typeof t)throw new Error("`tagName` must be a `string`.");if(e&&"object"!=typeof e)throw new Error("`attrs` must be an `object`.");const i=document.createElement(t);if(e)for(const[t,n]of Object.entries(e)){if("string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n||!1===n||null===n)continue;const e=n.toString();if("textContent"===t){i.textContent=e;continue}const r=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));i.setAttribute(r,e)}return i}async function L(t,e,i){if(i&&"number"!=typeof i)throw new Error("`timeoutDuration` must be a `number`.");const n=e||{},r=new AbortController;n.signal=r.signal;const s=setTimeout((()=>r.abort()),void 0===i?8e3:i<0?0:i),o=await fetch(t,n);return clearTimeout(s),o}function D(t,e,i){if("number"!=typeof t)throw new Error("`time` must be a `number`.");return new Promise(((n,r)=>{const s=()=>{clearTimeout(o),r(null==i?void 0:i.reason)};null==i||i.throwIfAborted();const o=setTimeout((()=>{null==i||i.removeEventListener("abort",s),n(e)}),t>=0?t:0);null==i||i.addEventListener("abort",s)}))}function k(t,e){if(!Array.isArray(t)||0===t.length)throw new Error("`numbers` must be a non-empty array.");if(e&&"string"!=typeof e)throw new Error("`round` value is invalid.");const i=t.reduce(((t,e)=>t+e),0)/t.length;if(Number.isNaN(i))throw new Error("Each item in `numbers` must be a `number`.");switch(e){case"floor":return Math.floor(i);case"ceil":return Math.ceil(i);default:return i}}function _(t){if("number"!=typeof t||Number.isNaN(t))return console.warn("`time` must be of type `number` and not NaN."),null;const e=t.toString().replace(".",""),i=e.length>16?e.slice(0,16):e.padEnd(16,"0");return Math.round(Number.parseInt(i)/1e3)}function B(t){return t.length<5?t:t.sort(((t,e)=>t-e)).slice(1,t.length-2)}const H={maxSyncAttempts:6,requiredOkSyncAttempts:4};class M{t1FetchOptions;t1CalcFn;t2CalcFn;maxSyncAttempts;requiredOkSyncAttempts;constructor(t){const e={...H,...t};e.t1EndpointUrl&&e.t1Endpoint&&console.warn("t1EndpointUrl and t1Endpoint.url are both provided. t1Endpoint.url will take preference.");const i=e.t1Endpoint?e.t1Endpoint.url:e.t1EndpointUrl;if(!i)throw new Error("t1 endpoint URL must be provided, either as t1EndpointUrl or t1Endpoint.url.");this.t1FetchOptions=[i,e.t1Endpoint?.fetchOptions,e.t1Endpoint?.timeoutDuration],this.t1CalcFn=e.t1CalcFn,this.t2CalcFn=e.t2CalcFn||null,this.maxSyncAttempts=e.maxSyncAttempts,this.requiredOkSyncAttempts=e.requiredOkSyncAttempts}async generateData(){try{const t=(new Date).valueOf(),e=await L(...this.t1FetchOptions);if(!e.ok)throw new Error("t1 data fetch failed.");const i=await this.t1CalcFn(e);if(null===i)throw new Error("t1 calculation returned `null`.");let n=i;if(this.t2CalcFn){const t=this.t2CalcFn(e.headers);null!==t&&t>i&&(n=t)}const r=(new Date).valueOf();if([t,i,n,r].some((t=>Number.isNaN(t))))throw new Error("Some of the time values aren't of type `number`.");return{roundTripDelay:r-t-(n-i),clientOffset:(i-t+(n-r))/2}}catch(t){throw t instanceof Error?t:new Error("Unknown error during NTP data generation.")}}async sync(){try{const t=[];for(let e=0,i=0;e<this.maxSyncAttempts;e++)try{e>this.requiredOkSyncAttempts&&await D(1e3);const n=await this.generateData();if(t.push(n),i++,i>this.requiredOkSyncAttempts)break}catch(t){console.error(t),this.maxSyncAttempts}if(t.length<this.requiredOkSyncAttempts)throw new Error(`Didn't meet the required amount of ${this.requiredOkSyncAttempts} successful sync attempts within the allowed amount of ${this.maxSyncAttempts} total.`);const e=k(B(t.map((t=>t.roundTripDelay))),"floor"),i=k(B(t.map((t=>t.clientOffset))),"floor");return{roundTripDelay:e,clientOffset:i,correctedDate:(new Date).valueOf()-i}}catch(t){throw t instanceof Error?t:new Error("Unknown error during NTP sync.")}}}class U{activatorButtonEl;id;problemFetchOptions;ntp;activatorButtonElDefaultProps;formEl;fieldEl;answerInputElDefaultProps;answerInputEl;labelEl;digit1InputEl;digit2InputEl;expiryTimerEl;loaderEl;active;expiryTimer;expiryTimerAbortController;constructor(t){try{this.activatorButtonEl=t.activatorButtonEl;const e=this.activatorButtonEl.closest("form");if(!e)throw new Error("Input must be a child of a <form>.");if(this.id="simple-maths-captcha",t.baseId&&(this.id=t.baseId+"-"+this.id),U.#S.find((t=>t.activatorButtonEl===this.activatorButtonEl||t.id===this.id)))throw new Error("Activator button and/or instance ID already in use.");U.#S.push({activatorButtonEl:this.activatorButtonEl,id:this.id}),t.generatorEndpointUrl&&t.generatorEndpoint&&console.warn("`generatorEndpointUrl` and `generatorEndpoint.url` are both provided. `generatorEndpoint.url` takes preference.");const i=t.generatorEndpoint?t.generatorEndpoint.url:t.generatorEndpointUrl;if(!i)throw new Error("Problem generator endpoint URL must be provided, either as generatorEndpointUrl or generatorEndpoint.url.");this.problemFetchOptions=[i,t.generatorEndpoint?.fetchOptions,t.generatorEndpoint?.timeoutDuration],this.ntp=new M(t.ntpOptions),this.activatorButtonEl.setCustomValidity("required"),this.activatorButtonElDefaultProps=[];for(const t of Array.from(this.activatorButtonEl.attributes))this.activatorButtonElDefaultProps.push(t.name);this.formEl=e,this.fieldEl=this.activatorButtonEl.parentElement||this.formEl;const n={type:"text",id:this.id+"-answer",name:this.id+"-answer",inputmode:"numeric",minlength:"1",required:"required"};return this.answerInputElDefaultProps=Object.keys(n),this.answerInputEl=q("input",n),this.labelEl=q("label",{for:this.answerInputEl.id}),this.digit1InputEl=q("input",{type:"hidden",id:this.id+"-digit-1",name:this.id+"-digit-1"}),this.digit2InputEl=q("input",{type:"hidden",id:this.id+"-digit-2",name:this.id+"-digit-2"}),this.expiryTimerEl=q("span"),this.loaderEl=q("div",{class:"spinner spinner--lg"}),this.active=!1,this.expiryTimer=void 0,this.expiryTimerAbortController=void 0,this.activatorButtonEl.addEventListener("click",(()=>{(async()=>await this.activate())().catch((t=>{console.error(t),this.deactivate()}))})),void(t.answerInputElEventHandlers&&t.answerInputElEventHandlers.forEach((t=>{this.answerInputEl.addEventListener(t.type,t.listener,t.options)})))}catch(t){throw t instanceof Error?t:new Error("Unknown error during initialization.")}}static#S=[];isCaptchaInputEl(t){return t===this.answerInputEl.id||t===this.digit1InputEl.id||t===this.digit2InputEl.id}async activate(){if(this.active)console.warn("CAPTCHA already active.");else{this.active=!0,this.expiryTimerAbortController=new AbortController;try{this.activatorButtonEl.remove(),this.labelEl.textContent="Loading CAPTCHA",this.fieldEl.prepend(this.labelEl,this.loaderEl),this.answerInputEl.value="";for(const t of Array.from(this.answerInputEl.attributes))this.answerInputElDefaultProps.includes(t.name)||this.answerInputEl.removeAttribute(t.name);const[t,e,i]=await this.#x();this.labelEl.textContent=`${t} + ${e} =`,this.digit1InputEl.value=t.toString(),this.digit2InputEl.value=e.toString(),this.labelEl.after(this.answerInputEl,this.digit1InputEl,this.digit2InputEl),this.loaderEl.remove();let n=Math.round(i/1e3);return this.expiryTimer=setInterval((()=>{n-=1,n<6&&(this.expiryTimerEl.textContent=`Expires in ${n} s`,document.body.contains(this.expiryTimerEl)||this.answerInputEl.after(this.expiryTimerEl))}),1e3),void await D(i,!0,this.expiryTimerAbortController.signal).then((()=>{clearInterval(this.expiryTimer),this.deactivate()})).catch((t=>{}))}catch(t){throw t instanceof Error?t:new Error("Unknown error during CAPTCHA activation.")}}}deactivate(){if(this.active){clearInterval(this.expiryTimer),this.expiryTimerAbortController?.abort("Scheduled deactivation aborted."),this.labelEl.remove(),this.answerInputEl.remove(),this.digit1InputEl.remove(),this.digit2InputEl.remove(),this.expiryTimerEl.remove(),this.loaderEl.remove();for(const t of Array.from(this.activatorButtonEl.attributes))this.activatorButtonElDefaultProps.includes(t.name)||this.activatorButtonEl.removeAttribute(t.name);this.fieldEl.prepend(this.activatorButtonEl),this.active=!1}else console.warn("CAPTCHA already deactivated.")}async#x(){try{const t=await this.ntp.sync();if(!t)throw new Error("NTP values fetch failed.");const e=await L(...this.problemFetchOptions);if(!e.ok)throw new Error("Problem fetch failed.");const i=await e.json(),[n,r,s]=i.problem_data;return[n,r,Math.ceil(Math.max(s-t.correctedDate,0))]}catch(t){throw t instanceof Error?t:new Error("Unknown error during problem fetch.")}}}function $(t,e){if("string"!=typeof t)throw new Error("`tagName` must be a `string`.");if(e&&"object"!=typeof e)throw new Error("`attrs` must be an `object`.");const i=document.createElement(t);if(e)for(const[t,n]of Object.entries(e)){if("string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n||!1===n||null===n)continue;const e=n.toString();if("textContent"===t){i.textContent=e;continue}const r=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));i.setAttribute(r,e)}return i}var F;!function(t){t.HIDE_BUSY="HIDE_BUSY",t.SHOW_BUSY="SHOW_BUSY",t.SHOWN="SHOWN",t.WAITING_ON_HIDE="WAITING_ON_HIDE"}(F||(F={}));const R=(t,e,i,n)=>{n=n||1;const r=function(t,e){if("number"!=typeof t||"number"!=typeof e)throw new Error("`min` and `max` must both be `number`s.");if(t<0||e<0||e<t)throw new Error("`min` and `max` must both be 0 or greater and `max` must be greater than `min`.");return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)}(t,e);if(i.includes(r)){if(n>3)throw new Error("Failed to generate a unique instanceId 3 times!");R(t,e,i,++n)}return r},j={parentEl:document.body,position:["top","center"],hideAfterTime:4e3,hideOlder:!1,dismissable:!1,classNames:[]};class W{hideAfterTime;hideOlder;dismissable;notifierEl;notifications;currentNotificationId;queuedNotifications;instanceId;constructor(t={}){const e={...j,...t};this.hideAfterTime=e.hideAfterTime,this.hideOlder=e.hideOlder,this.dismissable=e.dismissable,this.notifierEl=$("div",{class:`simple-notifier simple-notifier--position-x-${e.position[1]} simple-notifier--position-y-${e.position[0]}`,ariaLive:"assertive"}),this.notifierEl.classList.add(...e.classNames),this.notifications=new Map,this.currentNotificationId=0,this.queuedNotifications=[],this.instanceId=R(1e5,1e6,W.#T),W.#T.push(this.instanceId),e.parentEl.insertBefore(this.notifierEl,e.parentEl.firstElementChild)}static#T=[];get notificationIds(){return[...this.notifications.keys()]}#O(t,e){const i="object"!=typeof t||Array.isArray(t)?void 0:t,n=i?i.text:t;return{hideAfterTime:i?.hideAfterTime??this.hideAfterTime,hideOlder:i?.hideOlder??this.hideOlder,dismissable:i?.dismissable??this.dismissable,text:"string"==typeof n&&""!==n?[n]:n||null,title:i?.title||null,titleLevel:i?.titleLevel??"h6",variant:i?.variant??e??"default"}}#N(t,e){const i=$("div",{class:`simple-notification simple-notification--${e.variant} simple-notification--animation-in`,role:"alert",dataNotificationId:t.toString()}),n=$("div",{class:"simple-notification__part simple-notification__part--main"});if(e.title){const t=$(e.titleLevel,{class:"simple-notification__title",textContent:e.title});n.append(t)}if(e.text&&e.text.forEach((t=>{const e=$("p",{class:"simple-notification__text",textContent:t});n.append(e)})),i.append(n),e.dismissable){const e=$("div",{class:"simple-notification__part simple-notification__part--side"}),n=$("button",{type:"button",class:"simple-notification__hide-button",ariaLabel:"Dismiss notification"});n.addEventListener("click",(()=>this.hide(t)),{once:!0}),e.append(n),i.append(e)}return i}#P(){if(0===this.queuedNotifications.length)return;const t=[...this.queuedNotifications].reverse();this.queuedNotifications=[];let e=[],i=0;for(const n of t)if(i++,n.hideOlder){e=t.slice(0,i);break}e.reverse().forEach((t=>{this.show(t)}))}show(t,e){const i="object"==typeof t&&!Array.isArray(t);if(void 0===t||i&&void 0===t.text&&void 0===t.title)return void console.warn("`text` or `title` must be defined. `text` may be provided as `string` or `string[]` or via an `object` as `text` value.");if(void 0!==e&&"string"!=typeof e)return void console.warn("`variant` must be a `string`.");const n=(i&&t.hideOlder)??this.hideOlder;if(n&&this.notifications.size>0||this.queuedNotifications.length>0){const r=i?{...t,hideOlder:n}:{text:t,variant:e,hideOlder:n};return this.queuedNotifications.push(r),this.hideAll(),void this.notifierEl.addEventListener("allhidden",(()=>this.#P()),{once:!0})}const r=this.currentNotificationId;this.currentNotificationId++;const s=this.#O(t,e),o=this.#N(r,s),a={...s,state:F.SHOW_BUSY,el:o,abortController:new AbortController};this.notifications.set(r,a),this.notifierEl.append(o),o.addEventListener("animationend",(()=>{a.state=F.SHOWN;const t=new CustomEvent("shown",{detail:{instanceId:this.instanceId,notificationId:r}});this.notifierEl.dispatchEvent(t),s.hideAfterTime>0&&(a.state=F.WAITING_ON_HIDE,function(t,e,i){if("number"!=typeof t)throw new Error("`time` must be a `number`.");return new Promise(((e,n)=>{const r=()=>{clearTimeout(s),n(null==i?void 0:i.reason)};null==i||i.throwIfAborted();const s=setTimeout((()=>{null==i||i.removeEventListener("abort",r),e(!0)}),t>=0?t:0);null==i||i.addEventListener("abort",r)}))}(a.hideAfterTime,0,a.abortController.signal).then((()=>this.hide(r))).catch((t=>{})))}),{once:!0,signal:a.abortController.signal})}hide(t){if("number"!=typeof t)return void console.warn("`notificationId` must be a `number`.");const e=this.notifications.get(t);e?e.state!==F.HIDE_BUSY?(e.state!==F.SHOW_BUSY&&e.state!==F.WAITING_ON_HIDE||e.abortController.abort(`Scheduled hide or active show action of notification ${t} aborted.`),e.state=F.HIDE_BUSY,e.el.classList.remove("simple-notification--animation-in"),e.el.classList.add("simple-notification--animation-out"),e.el.addEventListener("animationend",(()=>{e.el.remove(),this.notifications.delete(t);const i=new CustomEvent("hidden",{detail:{instanceId:this.instanceId,notificationId:t}});if(this.notifierEl.dispatchEvent(i),0===this.notifications.size){const t=new CustomEvent("allhidden",{detail:{instanceId:this.instanceId}});this.notifierEl.dispatchEvent(t)}}),{once:!0})):console.warn(`Already hiding notification ${t}.`):console.warn(`Notification ${t} doesn't exist.`)}hideAll(){const t=[];for(const[e,i]of this.notifications.entries())i.state!==F.HIDE_BUSY&&t.push(e);0!==t.length&&t.forEach((t=>this.hide(t)))}}const z={default:"Input invalid",email:"Email address invalid",maxlength:"Input must be shorter than %d characters",minlength:"Input must contain more than %d characters",pattern:"Input format invalid",requiredEmpty:"Input required"},Q={title:"Message sent",text:"I'll be in touch soon!",variant:"success"},Y={text:"One or more fields failed validation. Please check and correct them.",variant:"warning"},V={text:"Failed to send message. Please try again at a later time.",variant:"error"},J={text:"Your message has been stored on your device. You may close this page and come back at a later time to retry sending it.",variant:"info",hideAfterTime:8e3},G={text:"Message removed from storage.",variant:"info"};function X(t,e="auto"){(function(t){if(!t.parentElement)return;const e=t.parentElement.querySelector(".field__message");e&&(e.textContent=function(t){if(!0===t.validity.valid)return null;if(t.validity.valueMissing||t.validity.customError&&"true"===t.getAttribute("data-required"))return z.requiredEmpty;if(t.validity.patternMismatch||t.validity.typeMismatch)return"email"===t.type?z.email:z.pattern;if(t.validity.tooLong){const e=t.getAttribute("maxlength");return z.maxlength.replace("%d",e||"the current amount of")}if(t.validity.tooShort){const e=t.getAttribute("minlength");return z.minlength.replace("%d",e||"the current amount of")}return z.default}(t))})(t),t.setAttribute("data-show-validation-message","true"),e&&t.setAttribute("data-show-validation-border",t.validity.valid&&"validNeutral"===e?"neutral":t.validity.valid?"valid":"invalid")}function Z(t){try{const e=t.querySelector("[type=submit]");if(!e)throw new Error("submitButtonEl not found!");const i=t.querySelector(`#${t.id}-simple-maths-captcha-activator`);if(!i)throw new Error("captchaActivatorButtonEl not found!");const n=new W({hideOlder:!0}),r=function(t,e){const i=new U({activatorButtonEl:e,baseId:t.id,generatorEndpoint:{url:"/api/simple-maths-captcha/generate-problem.php",fetchOptions:{method:"POST",body:JSON.stringify({base_id:t.id})}},answerInputElEventHandlers:[{type:"input",listener:()=>{i.answerInputEl.setAttribute("data-had-interaction","true"),i.answerInputEl.value.length>=i.answerInputEl.minLength&&i.answerInputEl.setCustomValidity(""),"true"===i.answerInputEl.getAttribute("data-rolling-validation")&&X(i.answerInputEl,"validNeutral")}},{type:"blur",listener:()=>{"true"===i.answerInputEl.getAttribute("data-had-interaction")&&i.answerInputEl.setAttribute("data-rolling-validation","true"),"true"===i.answerInputEl.getAttribute("data-rolling-validation")&&X(i.answerInputEl,"validNeutral")}}],ntpOptions:{t1EndpointUrl:"/api/ntp/get-server-time.php",t1CalcFn:async function(t){return _((await t.json()).req_received_time)},t2CalcFn:function(t){const e=t.get("Response-Timing");if(!e)return null;const i=/\bt=([0-9]+)\b/.exec(e),n=/\bD=([0-9]+)\b/.exec(e);return i&&n?_(Number.parseInt(i[1])+Number.parseInt(n[1])):null}}});return i}(t,i),s=localStorage.getItem(`${t.id}-data`);return s&&function(t,e,i){const n=q("fieldset"),r=q("legend",{textContent:"A previously unsent message was stored."}),s=q("div",{class:"item-grid"}),o=q("div",{class:"item"}),a=q("button",{type:"button",class:"btn btn--sm",textContent:"Load"});a.addEventListener("click",(()=>{!function(t,e){try{const i=e.querySelectorAll("input:not([type=button], [type=reset], [type=submit]), textarea"),n=JSON.parse(t),r=Object.keys(n);return void i.forEach((t=>{r.includes(t.id)&&(t.value=n[t.id],X(t))}))}catch(t){throw t instanceof Error?t:new Error("Unknown error retrieving stored form data!")}}(t,e),n.remove()}),{once:!0}),o.append(a);const l=q("div",{class:"item"}),u=q("button",{type:"button",class:"btn btn--sm",textContent:"Remove"});u.addEventListener("click",(()=>{localStorage.removeItem(`${e.id}-data`),n.remove(),i.show(G)}),{once:!0}),l.append(u),s.append(o,l),n.append(r,s),e.insertBefore(n,e.firstElementChild)}(s,t,n),t.querySelectorAll("input:not([type=button], [type=hidden], [type=reset], [type=submit]), textarea").forEach((t=>{t.addEventListener("input",(()=>{t.setAttribute("data-had-interaction","true"),"true"===t.getAttribute("data-rolling-validation")&&X(t)})),t.addEventListener("blur",(()=>{"true"===t.getAttribute("data-had-interaction")&&t.setAttribute("data-rolling-validation","true"),"true"===t.getAttribute("data-rolling-validation")&&X(t)}))})),e.addEventListener("click",(e=>{e.preventDefault(),async function(t,e,i){let n=!1;const r=t.querySelectorAll("fieldset");try{r.forEach((t=>{t.setAttribute("disabled","disabled")}));const s=t.querySelectorAll("input:not([type=button], [type=reset], [type=submit]), textarea"),o=new FormData;s.forEach((t=>{o.set(t.name,t.value)}));const a=await L("/api/form/submit-contact-form.php",{method:"POST",body:o});if(!a.ok){if(422===a.status){const t=await a.json();let n=null;if(t.invalid_form_controls.length>0){!function(t){const e=document.querySelector(`#${t}`);e&&(document.documentElement.classList.add("has-scroll-offset"),e.scrollIntoView(),document.documentElement.classList.remove("has-scroll-offset"))}(t.invalid_form_controls[0].id);for(const i of[e.activatorButtonEl,e.answerInputEl]){if(n)break;t.invalid_form_controls.find((t=>t.id===i.id))&&(n=i)}}e.answerInputEl.setCustomValidity(n?"required":""),i.show(Y)}else e.answerInputEl.setCustomValidity(""),localStorage.setItem(`${t.id}-data`,JSON.stringify(function(t,e){const i={};for(const[n,r]of t.entries())e.includes(n)||"string"==typeof r&&""!==r.trim()&&(i[n]=r);return i}(o,[e.answerInputEl.id,e.digit1InputEl.id,e.digit2InputEl.id]))),i.show(V),i.show({...J,hideOlder:!1});return}return n=!0,i.show(Q),localStorage.removeItem(`${t.id}-data`),void s.forEach((t=>t.value=""))}catch(t){throw i.show(V),t instanceof Error?t:new Error("Unknown error during form submission!")}finally{r.forEach((t=>t.removeAttribute("disabled"))),t.querySelectorAll("button[type=button], input:not([type=hidden], [type=reset], [type=submit]), textarea").forEach((t=>{n?(function(t){t.setAttribute("data-had-interaction","false"),t.setAttribute("data-rolling-validation","false"),t.setAttribute("data-show-validation-message","false"),t.setAttribute("data-show-validation-border","false")}(t),e.deactivate()):null===t.getAttribute("required")&&"true"!==t.getAttribute("data-required")||(t.setAttribute("data-rolling-validation","true"),X(t,t.id!==e.activatorButtonEl.id&&"auto"))}))}}(t,r,n).catch((t=>console.error(t)))})),t.querySelectorAll("fieldset:disabled").forEach((t=>t.removeAttribute("disabled"))),void t.classList.remove("has-overlay")}catch(t){throw t instanceof Error?t:new Error("Unknown error during form initialization!")}}!function(){document.documentElement.classList.replace("js-disabled","js-enabled"),document.body.addEventListener("mousedown",(()=>document.body.classList.add("using-mouse"))),document.body.addEventListener("keydown",(()=>document.body.classList.remove("using-mouse")));try{const t=document.querySelector(".viktor-properties-typeit > span");t&&new P(t,{speed:80,deleteSpeed:40,loop:!0}).type("Software devlo",{delay:500}).move(-2,{delay:350}).type("e",{delay:500}).move(2,{delay:400}).type("per",{delay:1850}).delete(void 0,{delay:900}).type("Photographer",{delay:1800}).delete(void 0,{delay:900}).type("Moti",{delay:400}).delete(2,{speed:120,delay:350}).type("toring enthusiast",{delay:2e3}).delete(void 0,{delay:900}).type("Human",{delay:1450}).delete(void 0,{delay:900}).go()}catch(t){console.error(t)}try{const t=document.querySelector("#contact-form");t&&Z(t)}catch(t){console.error(t)}}();