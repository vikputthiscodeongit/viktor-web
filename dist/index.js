document.body;const t=t=>Array.isArray(t),e=e=>t(e)?e:[e],i="data-typeit-id",n="ti-cursor",s={started:!1,completed:!1,frozen:!1,destroyed:!1},r={breakLines:!0,cursor:{autoPause:!0,autoPauseDelay:500,animation:{frames:[0,0,1].map((t=>({opacity:t}))),options:{iterations:1/0,easing:"steps(2, start)",fill:"forwards"}}},cursorChar:"|",cursorSpeed:1e3,deleteSpeed:null,html:!0,lifeLike:!0,loop:!1,loopDelay:750,nextStringDelay:750,speed:100,startDelay:250,startDelete:!1,strings:[],waitUntilVisible:!1,beforeString:()=>{},afterString:()=>{},beforeStep:()=>{},afterStep:()=>{},afterComplete:()=>{}},a=`[${i}]:before {content: '.'; display: inline-block; width: 0; visibility: hidden;}`,o=t=>document.createElement(t),l=t=>document.createTextNode(t),u=(t,e="")=>{let i=o("style");i.id=e,i.appendChild(l(t)),document.head.appendChild(i)},d=e=>(t(e)||(e=[e/2,e/2]),e),h=(t,e)=>Math.abs(Math.random()*(t+e-(t-e))+(t-e));let c=t=>t/2;const p=t=>Array.from(t);let m=t=>([...t.childNodes].forEach((t=>{if(t.nodeValue)return[...t.nodeValue].forEach((e=>{t.parentNode.insertBefore(l(e),t)})),void t.remove();m(t)})),t);const f=t=>{let e=document.implementation.createHTMLDocument();return e.body.innerHTML=t,m(e.body)};function y(t,e=!1,i=!1){let s,r=t.querySelector(`.${n}`),a=document.createTreeWalker(t,NodeFilter.SHOW_ALL,{acceptNode:t=>{if(r&&i){if(t.classList?.contains(n))return NodeFilter.FILTER_ACCEPT;if(r.contains(t))return NodeFilter.FILTER_REJECT}return t.classList?.contains(n)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),o=[];for(;s=a.nextNode();)s.originalParent||(s.originalParent=s.parentNode),o.push(s);return e?o.reverse():o}const b=({index:t,newIndex:e,queueItems:i,cleanUp:n})=>{for(let s=t+1;s<e+1;s++)n(i[s][0])},v=t=>Number.isInteger(t),E=({queueItems:t,selector:e,cursorPosition:i,to:n})=>{if(v(e))return-1*e;let s=new RegExp("END","i").test(n),r=e?[...t].reverse().findIndex((({char:t})=>{let i=t.parentElement,n=i.matches(e);return!(!s||!n)||n&&i.firstChild.isSameNode(t)})):-1;return r<0&&(r=s?0:t.length-1),r-i+(s?0:1)},g=(t,e)=>new Array(e).fill(t);let w=t=>new Promise((e=>{requestAnimationFrame((async()=>{e(await t())}))})),I=t=>t?.getAnimations().find((e=>e.id===t.dataset.tiAnimationId)),A=({cursor:t,frames:e,options:i})=>{let n=t.animate(e,i);return n.pause(),n.id=t.dataset.tiAnimationId,w((()=>{w((()=>{n.play()}))})),n},C=t=>t.func?.call(null);const S=t=>"value"in t;let O=t=>"function"==typeof t?t():t,T=(t,e=document,i=!1)=>e["querySelector"+(i?"All":"")](t);const x=(t,e)=>Object.assign({},t,e);let q={"font-family":"","font-weight":"","font-size":"","font-style":"","line-height":"",color:"",transform:"translateX(-.125em)"};class P{element;timeouts;cursorPosition;predictedCursorPosition;statuses={started:!1,completed:!1,frozen:!1,destroyed:!1,firing:!1};opts;id;queue;cursor;flushCallback=null;unfreeze=()=>{};constructor(t,i={}){var n;this.opts=x(r,i),this.element="string"==typeof(n=t)?T(n):n,this.timeouts=[],this.cursorPosition=0,this.unfreeze=()=>{},this.predictedCursorPosition=null,this.statuses=x({},s),this.id=Math.random().toString().substring(2,9),this.queue=function(t){let i=function(t){return e(t).forEach((t=>a.set(Symbol(t.char?.innerText),n({...t})))),this},n=t=>(t.shouldPauseCursor=function(){return Boolean(this.typeable||this.cursorable||this.deletable)},t),s=()=>a,r=()=>Array.from(a.values()),a=new Map;return i(t),{add:i,set:function(t,e){let i=[...a.keys()];a.set(i[t],n(e))},wipe:function(){a=new Map,i(t)},done:(t,e=!1)=>e?a.delete(t):a.get(t).done=!0,reset:function(){a.forEach((t=>delete t.done))},destroy:t=>a.delete(t),getItems:(t=!1)=>t?r():r().filter((t=>!t.done)),getQueue:s,getTypeable:()=>r().filter((t=>t.typeable)),getPendingQueueItems:()=>{const t=[];for(let[,e]of s())e.done||t.push(e);return t}}}([{delay:this.opts.startDelay}]),this.#t(i),this.cursor=this.#e(),this.element.dataset.typeitId=this.id,u(a),this.opts.strings.length&&this.#i()}go(){return this.statuses.started?this:(this.#n(),this.opts.waitUntilVisible?(t=this.element,e=this.#s.bind(this),new IntersectionObserver(((i,n)=>{i.forEach((i=>{i.isIntersecting&&(e(),n.unobserve(t))}))}),{threshold:1}).observe(t),this):(this.#s(),this));var t,e}destroy(t=!0){this.timeouts=(this.timeouts.forEach(clearTimeout),[]),O(t)&&this.cursor&&this.#r(this.cursor),this.statuses.destroyed=!0}reset(t){!this.is("destroyed")&&this.destroy(),t?(this.queue.wipe(),t(this)):this.queue.reset(),this.cursorPosition=0;for(let t in this.statuses)this.statuses[t]=!1;return this.element[this.#a()?"value":"innerHTML"]="",this}is=function(t){return this.statuses[t]};type(t,e={}){t=O(t);let{instant:i}=e,n=this.#o(e),s=function(t,e=!0){return e?y(f(t)):p(t).map(l)}(t,this.opts.html).map((t=>{return{func:()=>this.#l(t),char:t,delay:i||(e=t,/<(.+)>(.*?)<\/(.+)>/.test(e.outerHTML))?0:this.#u(),typeable:t.nodeType===Node.TEXT_NODE};var e})),r=[n[0],{func:async()=>await this.opts.beforeString(t,this)},...s,{func:async()=>await this.opts.afterString(t,this)},n[1]];return this.#d(r,e)}break(t={}){return this.#d({func:()=>this.#l(o("BR")),typeable:!0},t)}move(t,e={}){t=O(t);let i=this.#o(e),{instant:n,to:s}=e,r=E({queueItems:this.queue.getTypeable(),selector:null===t?"":t,to:s,cursorPosition:this.#h}),a=r<0?-1:1;return this.predictedCursorPosition=this.#h+r,this.#d([i[0],...g({func:()=>this.#c(a),delay:n?0:this.#u(),cursorable:!0},Math.abs(r)),i[1]],e)}exec(t,e={}){let i=this.#o(e);return this.#d([i[0],{func:()=>t(this)},i[1]],e)}options(t,e={}){return t=O(t),this.#p(t),this.#d({},e)}pause(t,e={}){return this.#d({delay:O(t)},e)}delete(t=null,e={}){t=O(t);let i=this.#o(e),n=t,{instant:s,to:r}=e,a=this.queue.getTypeable(),o=(()=>null===n?a.length:v(n)?n:E({queueItems:a,selector:n,cursorPosition:this.#h,to:r}))();return this.#d([i[0],...g({func:this.#m.bind(this),delay:s?0:this.#u(1),deletable:!0},o),i[1]],e)}freeze(){this.statuses.frozen=!0}flush(t=null){return this.flushCallback=t||this.flushCallback,this.statuses.firing||(this.#n(),this.#s(!1).then((()=>{if(this.queue.getPendingQueueItems().length>0)return this.flush();this.flushCallback(),this.flushCallback=null}))),this}getQueue(){return this.queue}getOptions(){return this.opts}updateOptions(t){return this.#p(t)}getElement(){return this.element}empty(t={}){return this.#d({func:this.#f.bind(this)},t)}async#f(){this.#a()?this.element.value="":this.#y.forEach(this.#r.bind(this))}async#s(t=!0){this.statuses.started=!0,this.statuses.firing=!0;let e=e=>{this.queue.done(e,!t)};try{let i=[...this.queue.getQueue()];for(let t=0;t<i.length;t++){let[n,s]=i[t];if(!s.done){if(!s.deletable||s.deletable&&this.#y.length){let n=await this.#b(t,i);b({index:t,newIndex:n,queueItems:i,cleanUp:e}),t=n}e(n)}}if(!t)return this.statuses.firing=!1,this;if(this.statuses.completed=!0,this.statuses.firing=!1,await this.opts.afterComplete(this),!this.opts.loop)throw"";let n=this.opts.loopDelay;this.#v((async()=>{await this.#E(n[0]),this.#s()}),n[1])}catch(t){}return this.statuses.firing=!1,this}async#c(t){var e,i,s;this.cursorPosition=(e=t,i=this.cursorPosition,s=this.#y,Math.min(Math.max(i+e,0),s.length)),(t=>{let e=this.#y[this.cursorPosition-1],i=T(`.${n}`,t);(t=e?.parentNode||t).insertBefore(i,e||null)})(this.element)}async#E(t){let e=this.#h;e&&await this.#c({value:e});let i=this.#y.map((t=>[Symbol(),{func:this.#m.bind(this),delay:this.#u(1),deletable:!0,shouldPauseCursor:()=>!0}]));for(let t=0;t<i.length;t++)await this.#b(t,i);this.queue.reset(),this.queue.set(0,{delay:t})}#b(t,e){return(async({index:t,queueItems:e,wait:i,cursor:n,cursorOptions:s})=>{let r=e[t][1],a=[],o=t,l=r,u=()=>l&&!l.delay,d=r.shouldPauseCursor()&&s.autoPause;for(;u();)a.push(l),u()&&o++,l=e[o]?e[o][1]:null;if(a.length)return await w((async()=>{for(let t of a)await C(t)})),o-1;let h,c=I(n);return c&&(h={...c.effect.getComputedTiming(),delay:d?s.autoPauseDelay:0}),await i((async()=>{c&&d&&c.cancel(),await w((()=>{C(r)}))}),r.delay),await(({cursor:t,options:e,cursorOptions:i})=>{if(!t||!i)return;let n,s=I(t);s&&(e.delay=s.effect.getComputedTiming().delay,n=s.currentTime,s.cancel());let r=A({cursor:t,frames:i.animation.frames,options:e});return n&&(r.currentTime=n),r})({cursor:n,options:h,cursorOptions:s}),t})({index:t,queueItems:e,wait:this.#v.bind(this),cursor:this.cursor,cursorOptions:this.opts.cursor})}async#v(t,e,i=!1){this.statuses.frozen&&await new Promise((t=>{this.unfreeze=()=>{this.statuses.frozen=!1,t()}})),i||await this.opts.beforeStep(this),await((t,e,i)=>new Promise((n=>{i.push(setTimeout((async()=>{await t(),n()}),e||0))})))(t,e,this.timeouts),i||await this.opts.afterStep(this)}async#n(){if(!this.#a()&&this.cursor&&this.element.appendChild(this.cursor),this.#g){((t,e)=>{let s=`[${i}='${t}'] .${n}`,r=getComputedStyle(e),a=Object.entries(q).reduce(((t,[e,i])=>`${t} ${e}: var(--ti-cursor-${e}, ${i||r[e]});`),"");u(`${s} { display: inline-block; width: 0; ${a} }`,t)})(this.id,this.element),this.cursor.dataset.tiAnimationId=this.id;let{animation:t}=this.opts.cursor,{frames:e,options:s}=t;A({frames:e,cursor:this.cursor,options:{duration:this.opts.cursorSpeed,...s}})}}#a(){return S(this.element)}#d(t,e){return this.queue.add(t),this.#w(e),this}#w(t={}){let e=t.delay;e&&this.queue.add({delay:e})}#o(t={}){return[{func:()=>this.#p(t)},{func:()=>this.#p(this.opts)}]}async#p(t){this.opts=x(this.opts,t)}#i(){let t=this.opts.strings.filter((t=>!!t));t.forEach(((e,i)=>{if(this.type(e),i+1===t.length)return;let n=this.opts.breakLines?[{func:()=>this.#l(o("BR")),typeable:!0}]:g({func:this.#m.bind(this),delay:this.#u(1)},this.queue.getTypeable().length);this.#I(n)}))}#t=t=>{this.opts.cursor=(t=>{if("object"==typeof t){let e={},{frames:i,options:n}=r.cursor.animation;return e.animation=t.animation||{},e.animation.frames=t.animation?.frames||i,e.animation.options=x(n,t.animation?.options||{}),e.autoPause=t.autoPause??r.cursor.autoPause,e.autoPauseDelay=t.autoPauseDelay||r.cursor.autoPauseDelay,e}return!0===t?r.cursor:t})(t.cursor??r.cursor),this.opts.strings=this.#A(e(this.opts.strings)),this.opts=x(this.opts,{html:!this.#C&&this.opts.html,nextStringDelay:d(this.opts.nextStringDelay),loopDelay:d(this.opts.loopDelay)})};#A(t){let e=this.element.innerHTML;return e?(this.element.innerHTML="",this.opts.startDelete?(this.element.innerHTML=e,m(this.element),this.#I(g({func:this.#m.bind(this),delay:this.#u(1),deletable:!0},this.#y.length)),t):(i=e,i.replace(/<!--(.+?)-->/g,"").trim().split(/<br(?:\s*?)(?:\/)?>/)).concat(t)):t;var i}#e(){if(this.#C)return null;let t=o("span");return t.className=n,this.#g?(t.innerHTML=f(this.opts.cursorChar).innerHTML,t):(t.style.visibility="hidden",t)}#I(t){let e=this.opts.nextStringDelay;this.queue.add([{delay:e[0]},...t,{delay:e[1]}])}#l(t){((t,e)=>{if(S(t))return void(t.value=`${t.value}${e.textContent}`);e.innerHTML="";let i=(s=e.originalParent,/body/i.test(s?.tagName)?t:e.originalParent||t);var s;let r=T("."+n,i)||null;r&&r.parentElement!==i&&(i=r.parentElement),i.insertBefore(e,r)})(this.element,t)}#m(){this.#y.length&&(this.#C?this.element.value=this.element.value.slice(0,-1):this.#r(this.#y[this.cursorPosition]))}#r(t){((t,e)=>{if(!t)return;let i=t.parentNode;(i.childNodes.length>1||i.isSameNode(e)?t:i).remove()})(t,this.element)}#u(t=0){return function(t){let{speed:e,deleteSpeed:i,lifeLike:n}=t;return i=null!==i?i:e/3,n?[h(e,c(e)),h(i,c(i))]:[e,i]}(this.opts)[t]}get#h(){return this.predictedCursorPosition??this.cursorPosition}get#C(){return S(this.element)}get#g(){return!!this.opts.cursor&&!this.#C}get#y(){return t=this.element,S(t)?p(t.value):y(t,!0).filter((t=>!(t.childNodes.length>0)));var t}}function L(t,e){if("string"!=typeof t)throw new Error("`tagName` must be a `string`.");if(e&&"object"!=typeof e)throw new Error("`attrs` must be an `object`.");const i=document.createElement(t);if(e)for(const[t,n]of Object.entries(e)){if("string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n||!1===n||null===n)continue;const e=n.toString();if("textContent"===t){i.textContent=e;continue}const s=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));i.setAttribute(s,e)}return i}async function N(t,e,i){if(i&&"number"!=typeof i)throw new Error("`timeoutDuration` must be a `number`.");const n=e||{},s=new AbortController;n.signal=s.signal;const r=setTimeout((()=>s.abort()),void 0===i?8e3:i<0?0:i),a=await fetch(t,n);return clearTimeout(r),a}function D(t,e,i){if("number"!=typeof t)throw new Error("`time` must be a `number`.");return new Promise(((n,s)=>{const r=()=>{clearTimeout(a),s(null==i?void 0:i.reason)};null==i||i.throwIfAborted();const a=setTimeout((()=>{null==i||i.removeEventListener("abort",r),n(e)}),t>=0?t:0);null==i||i.addEventListener("abort",r)}))}function _(t,e){if(!Array.isArray(t)||0===t.length)throw new Error("`numbers` must be a non-empty array.");if(e&&"string"!=typeof e)throw new Error("`round` value is invalid.");const i=t.reduce(((t,e)=>t+e),0)/t.length;if(Number.isNaN(i))throw new Error("Each item in `numbers` must be a `number`.");switch(e){case"floor":return Math.floor(i);case"ceil":return Math.ceil(i);default:return i}}function k(t){if("number"!=typeof t||Number.isNaN(t))return console.warn("`time` must be of type `number` and not NaN."),null;const e=t.toString().replace(".",""),i=e.length>16?e.slice(0,16):e.padEnd(16,"0");return Math.round(Number.parseInt(i)/1e3)}function B(t){return t.length<5?t:t.sort(((t,e)=>t-e)).slice(1,t.length-2)}class H{#S;t1CalcFn;t2CalcFn;maxSyncAttempts;requiredOkSyncAttempts;constructor(t){this.#S=(t=>"t1Endpoint"in t)(t)?[t.t1Endpoint.url,t.t1Endpoint.fetchOptions,t.t1Endpoint.timeoutDuration]:[t.t1EndpointUrl],this.t1CalcFn=t.t1CalcFn,this.t2CalcFn=t.t2CalcFn??null,this.maxSyncAttempts=t.maxSyncAttempts??6,this.requiredOkSyncAttempts=t.requiredOkSyncAttempts??4}async generateData(){const t=(new Date).valueOf(),e=await N(...this.#S);if(!e.ok)throw new Error("t1 data fetch failed.");const i=await this.t1CalcFn(e);if(null===i)throw new Error("t1 calculation returned `null`.");let n=i;if(this.t2CalcFn){const t=this.t2CalcFn(e.headers);null!==t&&t>i?n=t:console.warn("t2 calculation failed. Using t1 as t2.")}const s=(new Date).valueOf();if([t,i,n,s].some((t=>Number.isNaN(t))))throw new Error("One or more time values are invalid.");return{roundTripDelay:s-t-(n-i),clientOffset:(i-t+(n-s))/2}}async sync(){const t=[];for(let e=0,i=0;e<this.maxSyncAttempts;e++)try{e>this.requiredOkSyncAttempts&&await D(1e3);const n=await this.generateData();if(t.push(n),i++,i>this.requiredOkSyncAttempts)break}catch(t){console.error(t),this.maxSyncAttempts}if(t.length<this.requiredOkSyncAttempts)throw new Error(`Didn't meet the required amount of successful sync attempts (${this.requiredOkSyncAttempts} out of ${this.maxSyncAttempts}).`);const e=_(B(t.map((t=>t.roundTripDelay))),"floor"),i=_(B(t.map((t=>t.clientOffset))),"floor");return{roundTripDelay:e,clientOffset:i,correctedDate:(new Date).valueOf()-i}}}class F{activatorButtonEl;id;ntp;#O;#T;#x;formEl;fieldEl;#q;answerInputEl;labelElLoadingText;labelEl;digit1InputEl;digit2InputEl;loaderEl;#P;#L;constructor(t){this.activatorButtonEl=t.activatorButtonEl;const e=this.activatorButtonEl.closest("form");if(!e)throw new Error("Input must be a child of a <form>.");if(this.id=t.id??"simple-maths-captcha",F.#N.find((t=>t.activatorButtonEl===this.activatorButtonEl||t.id===this.id)))throw new Error("Activator button and/or instance ID already in use.");F.#N.push({activatorButtonEl:this.activatorButtonEl,id:this.id}),this.ntp=t.ntp,this.#O=(t=>"dataEndpoint"in t)(t)?[t.dataEndpoint.url,t.dataEndpoint.fetchOptions,t.dataEndpoint.timeoutDuration]:[t.dataEndpointUrl],this.#T=t.dataHandlerFn,this.activatorButtonEl.setCustomValidity("required"),this.#x=Array.from(this.activatorButtonEl.attributes).map((t=>t.name)),this.formEl=e,this.fieldEl=this.activatorButtonEl.parentElement||this.formEl;const i={type:"text",id:this.id+"-answer",class:t.answerInputElClass??null,name:this.id+"-answer",inputmode:"numeric",minlength:"1",required:"required"};this.#q=Object.keys(i),this.answerInputEl=L("input",i),this.labelElLoadingText=t.labelElLoadingText??"Loading CAPTCHA",this.labelEl=L("label",{for:i.id}),this.digit1InputEl=L("input",{type:"hidden",id:this.id+"-digit-1",name:this.id+"-digit-1"}),this.digit2InputEl=L("input",{type:"hidden",id:this.id+"-digit-2",name:this.id+"-digit-2"}),this.loaderEl=t.loaderEl??null,this.#P=!1,this.#L=null,this.activatorButtonEl.addEventListener("click",(()=>{(async()=>await this.activate())().catch((t=>{console.error(t),this.deactivate()}))})),t.answerInputElEventHandlers?.forEach((t=>{this.answerInputEl.addEventListener(t.type,t.listener,t.options)}))}static#N=[];get active(){return this.#P}async#D(){const t=await this.ntp.sync();if(!t)throw new Error("NTP values fetch failed.");const e=await N(...this.#O);if(!e.ok)throw new Error("Problem fetch failed.");const i=await this.#T(e);if(!i)throw new Error("Fetched data doesn't satisfy problem data constraints.");const n=Math.ceil(Math.max(i[2]-t.correctedDate,0));return[i[0],i[1],n]}async activate(){if(this.#P)return void console.warn("Already active.");this.#P=!0,this.#L=new AbortController,this.activatorButtonEl.remove(),this.labelEl.textContent=this.labelElLoadingText,this.fieldEl.prepend(this.labelEl),this.loaderEl&&this.labelEl.after(this.loaderEl),this.answerInputEl.value="";for(const t of Array.from(this.answerInputEl.attributes))this.#q.includes(t.name)||this.answerInputEl.removeAttribute(t.name);const[t,e,i]=await this.#D();this.labelEl.textContent=`${t} + ${e} =`,this.digit1InputEl.value=t.toString(),this.digit2InputEl.value=e.toString(),this.labelEl.after(this.answerInputEl,this.digit1InputEl,this.digit2InputEl),this.loaderEl&&this.loaderEl.remove(),await D(i,!0,this.#L.signal).then((()=>this.deactivate())).catch((t=>{}))}deactivate(){if(this.#P){this.#L?.abort("Scheduled deactivation aborted."),this.labelEl.remove(),this.answerInputEl.remove(),this.digit1InputEl.remove(),this.digit2InputEl.remove(),this.loaderEl&&this.loaderEl.remove();for(const t of Array.from(this.activatorButtonEl.attributes))this.#x.includes(t.name)||this.activatorButtonEl.removeAttribute(t.name);this.fieldEl.prepend(this.activatorButtonEl),this.#P=!1}else console.warn("Already deactivated.")}}var M;!function(t){t.HIDE_BUSY="HIDE_BUSY",t.SHOW_BUSY="SHOW_BUSY",t.SHOWN="SHOWN",t.WAITING_ON_HIDE="WAITING_ON_HIDE"}(M||(M={}));const $={parentEl:document.body,position:["start","center"],hideAfterTime:4e3,hideOlder:!1,dismissible:!1,classNames:[]};class R{hideAfterTime;hideOlder;dismissible;el;notifications;#_;queue;hideButtonElAriaLabelText;constructor(t={}){const e={...$,...t};this.hideAfterTime=e.hideAfterTime,this.hideOlder=e.hideOlder,this.dismissible=e.dismissible,this.el=L("div",{class:`simple-notifier simple-notifier--position-x-${e.position[1]} simple-notifier--position-y-${e.position[0]}`,ariaLive:"assertive"}),this.el.classList.add(...e.classNames),this.notifications=new Map,this.#_=0,this.queue=[],this.hideButtonElAriaLabelText=e.hideButtonElAriaLabelText??"Dismiss notification";const i=e.parentEl.querySelector(".simple-notifier");i?i.after(this.el):e.parentEl.before(this.el)}get currentId(){return this.#_}get ids(){return[...this.notifications.keys()]}#k(t){return{hideAfterTime:t?.hideAfterTime??this.hideAfterTime,hideOlder:t?.hideOlder??this.hideOlder,dismissible:t?.dismissible??this.dismissible,text:"string"==typeof t.text?[t.text]:t.text??null,title:"string"==typeof t.title?[t.title,"h6"]:t.title??null,variant:t?.variant??"default"}}#B(t,e){const i=L("div",{class:`simple-notification simple-notification--${e.variant} simple-notification--animation-in`,role:"alert",dataNotificationId:t.toString()}),n=L("div",{class:"simple-notification__part simple-notification__part--main"});if(e.title){const t=L(e.title[1],{class:"simple-notification__title"});t.innerHTML=e.title[0],n.append(t)}if(e.text&&e.text.forEach((t=>{const e=L("p",{class:"simple-notification__text"});e.innerHTML=t,n.append(e)})),i.append(n),e.dismissible){const n=L("div",{class:"simple-notification__part simple-notification__part--side"}),s=L("button",{type:"button",class:"simple-notification__hide-button",ariaLabel:this.hideButtonElAriaLabelText});s.addEventListener("click",(()=>this.hide(t)),{once:!0,signal:e.abortControllers.hideButtonElEvent.signal}),n.append(s),i.append(n)}return i}#H(){if(0===this.queue.length)return;const t=[...this.queue].reverse();this.queue.length=0;let e=[],i=0;for(const n of t)if(i++,n.hideOlder){e=t.slice(0,i);break}e.reverse().forEach((t=>this.show(t)))}show(t,e){const i="string"==typeof t||Array.isArray(t)?{text:t,variant:e}:{...t,variant:e??t?.variant};if(!i)return void console.warn("Nothing to show as no parameters were provided.");const n=this.#k(i);if(!n.text&&!n.title)return void console.warn("Nothing to show as neither text nor title is provided.");if(n.hideOlder&&this.notifications.size>0||this.queue.length>0)return this.queue.push({...i,hideOlder:n.hideOlder}),this.el.addEventListener("allhidden",(()=>this.#H()),{once:!0}),void this.hideAll();const s=this.#_;this.#_++;const r={...n,state:M.SHOW_BUSY,abortControllers:{hideButtonElEvent:new AbortController,waitForHide:new AbortController}},a={...r,el:this.#B(s,r)};this.notifications.set(s,a),this.el.append(a.el),a.el.addEventListener("animationend",(()=>{a.state=M.SHOWN;const t=new CustomEvent("shown",{detail:{id:s}});this.el.dispatchEvent(t),a.hideAfterTime>0&&(a.state=M.WAITING_ON_HIDE,D(a.hideAfterTime,!0,a.abortControllers.waitForHide.signal).then((()=>this.hide(s))).catch((t=>{})))}),{once:!0,signal:a.abortControllers.waitForHide.signal})}hide(t){const e=this.notifications.get(t);e&&e.state!==M.HIDE_BUSY&&(e.state!==M.SHOW_BUSY&&e.state!==M.WAITING_ON_HIDE||(e.abortControllers.hideButtonElEvent.abort(`Hide button event of notification ${t} aborted.`),e.abortControllers.waitForHide.abort(`Scheduled hide or active show action of notification ${t} aborted.`)),e.state=M.HIDE_BUSY,e.el.classList.remove("simple-notification--animation-in"),e.el.classList.add("simple-notification--animation-out"),e.el.addEventListener("animationend",(()=>{e.el.innerHTML="",e.el.remove(),this.notifications.delete(t);const i=new CustomEvent("hidden",{detail:{id:t}});if(this.el.dispatchEvent(i),0===this.notifications.size){const t=new CustomEvent("allhidden");this.el.dispatchEvent(t)}}),{once:!0}))}hideAll(){const t=[];for(const[e,i]of this.notifications.entries())i.state!==M.HIDE_BUSY&&t.push(e);0!==t.length&&t.forEach((t=>this.hide(t)))}}const U={default:"Input invalid",email:"Email address invalid",maxlength:"Input must be shorter than %d characters",minlength:"Input must contain more than %d characters",pattern:"Input format invalid",requiredEmpty:"Input required"},j={title:"Message sent",text:"I'll be in touch soon!",variant:"success"},W={text:"One or more fields failed validation. Please check and correct them.",variant:"warning"},Q={text:"Failed to send message. Please try again at a later time.",variant:"error"},z={text:["Your message has been stored on your device.","You may close this page and come back at a later time to retry sending it."],variant:"warning",hideAfterTime:6e3},Y={text:"Message removed from storage."};function V(t,e="auto"){(function(t){if(!t.parentElement)return;const e=t.parentElement.querySelector(".field__message");e&&(e.textContent=function(t){if(!0===t.validity.valid)return null;if(t.validity.valueMissing||t.validity.customError&&"true"===t.getAttribute("data-required"))return U.requiredEmpty;if(t.validity.patternMismatch||t.validity.typeMismatch)return"email"===t.type?U.email:U.pattern;if(t.validity.tooLong){const e=t.getAttribute("maxlength");return U.maxlength.replace("%d",e||"the current amount of")}if(t.validity.tooShort){const e=t.getAttribute("minlength");return U.minlength.replace("%d",e||"the current amount of")}return U.default}(t))})(t),t.setAttribute("data-show-validation-message","true"),e&&t.setAttribute("data-show-validation-border",t.validity.valid&&"neutral"===e?"neutral":t.validity.valid?"valid":"invalid")}function J(t){const e=t.querySelector("[type=submit]");if(!e)throw new Error("submitButtonEl not found!");const i=function(t){const e=t.name||t.id?(t.name??t.id)+"-simple-maths-captcha":"simple-maths-captcha",i=t.querySelector(`#${e}-activator`);if(!i)throw new Error("Failed to initialize SimpleMathsCaptcha - activator button not found.");const n=new H({t1EndpointUrl:"/api/ntp/get-server-time.php",t1CalcFn:async function(t){const e=await t.json();return"object"==typeof(i=e)&&null!==i&&"received_time"in i?k(e.received_time):null;var i},t2CalcFn:function(t){const e=t.get("Response-Timing");if(!e)return null;const i=/\bt=([0-9]+)\b/.exec(e),n=/\bD=([0-9]+)\b/.exec(e);return i&&n?k(Number.parseInt(i[1])+Number.parseInt(n[1])):null}}),s=new F({activatorButtonEl:i,id:e,ntp:n,dataEndpoint:{url:"/api/simple-maths-captcha/generate-problem.php",fetchOptions:{method:"POST",body:JSON.stringify({id:e})}},dataHandlerFn:async function(t){const e=await t.json();return"object"==typeof(i=e)&&null!==i&&"digit_1"in i&&"digit_2"in i&&"invalid_after"in i&&Object.values(i).every((t=>"number"==typeof t))?[e.digit_1,e.digit_2,e.invalid_after]:null;var i},answerInputElEventHandlers:[{type:"input",listener:()=>{s.answerInputEl.setAttribute("data-had-interaction","true"),s.answerInputEl.value.length>=s.answerInputEl.minLength&&s.answerInputEl.setCustomValidity(""),"true"===s.answerInputEl.getAttribute("data-update-validation-on-input")&&V(s.answerInputEl,"neutral")}},{type:"blur",listener:()=>{"true"===s.answerInputEl.getAttribute("data-had-interaction")&&s.answerInputEl.setAttribute("data-update-validation-on-input","true"),"true"===s.answerInputEl.getAttribute("data-update-validation-on-input")&&V(s.answerInputEl,"neutral")}}],loaderEl:L("div",{class:"spinner spinner--lg",role:"presentation"})});return s}(t),n=new R({hideOlder:!0}),s=localStorage.getItem(`${t.name}-data`);s&&function(t,e,i){const n=L("fieldset"),s=L("legend",{textContent:"A previously unsent message was stored."}),r=L("div",{class:"item-grid"}),a=L("div",{class:"item"}),o=L("button",{type:"button",class:"btn btn--sm",textContent:"Load"});o.addEventListener("click",(()=>{!function(t,e){try{const i=e.querySelectorAll("input, textarea"),n=JSON.parse(t),s=Object.keys(n);return void i.forEach((t=>{s.includes(t.id)&&(t.value=n[t.id],V(t))}))}catch(t){throw t instanceof Error?t:new Error("Unknown error retrieving stored form data!")}}(t,e),n.remove()}),{once:!0}),a.append(o);const l=L("div",{class:"item"}),u=L("button",{type:"button",class:"btn btn--sm",textContent:"Remove"});u.addEventListener("click",(()=>{localStorage.removeItem(`${e.name}-data`),n.remove(),i.show(Y)}),{once:!0}),l.append(u),r.append(a,l),n.append(s,r),e.insertBefore(n,e.firstElementChild)}(s,t,n),t.querySelectorAll("input:not([type=button], [type=hidden], [type=reset], [type=submit]), textarea").forEach((t=>{t.addEventListener("input",(()=>{t.setAttribute("data-had-interaction","true"),"true"===t.getAttribute("data-update-validation-on-input")&&V(t)})),t.addEventListener("blur",(()=>{"true"===t.getAttribute("data-had-interaction")&&t.setAttribute("data-update-validation-on-input","true"),"true"===t.getAttribute("data-update-validation-on-input")&&V(t)}))})),e.addEventListener("click",(e=>{e.preventDefault(),async function(t,e,i){let n=!1;const s=t.querySelectorAll("fieldset"),r=t.querySelectorAll("input:not([type=button], [type=reset], [type=submit]), textarea");try{s.forEach((t=>{t.setAttribute("disabled","disabled")}));const a=new FormData;r.forEach((t=>{a.set(t.name,t.value)}));const o=await N("/api/form/submit-contact-form.php",{method:"POST",body:a});if(!o.ok){if(422===o.status){const t=await o.json(),n=t=>"object"==typeof t&&null!==t&&"invalid_form_controls"in t&&Array.isArray(t.invalid_form_controls);let s=null;if(n(t)&&t.invalid_form_controls.length>0){!function(t){const e=document.querySelector(`#${t}`);e&&(document.documentElement.classList.add("has-scroll-offset"),e.scrollIntoView(),document.documentElement.classList.remove("has-scroll-offset"))}(t.invalid_form_controls[0].id);for(const i of[e.activatorButtonEl,e.answerInputEl]){if(s)break;t.invalid_form_controls.find((t=>t.id===i.id))&&(s=i)}}e.answerInputEl.setCustomValidity(s?"required":""),i.show(W)}else e.answerInputEl.setCustomValidity(""),localStorage.setItem(`${t.name}-data`,JSON.stringify(function(t,e){const i={};for(const[n,s]of t.entries())e.includes(n)||"string"==typeof s&&""!==s.trim()&&(i[n]=s);return i}(a,[e.answerInputEl.id,e.digit1InputEl.id,e.digit2InputEl.id]))),i.show(Q),i.show({...z,hideOlder:!1});return}return n=!0,i.show(j),localStorage.removeItem(`${t.name}-data`),void r.forEach((t=>t.value=""))}catch(t){throw i.show(Q),t instanceof Error?t:new Error("Unknown error during form submission!")}finally{if(s.forEach((t=>t.removeAttribute("disabled"))),n)r.forEach((t=>function(t){t.setAttribute("data-had-interaction","false"),t.setAttribute("data-update-validation-on-input","false"),t.setAttribute("data-show-validation-message","false"),t.setAttribute("data-show-validation-border","false")}(t))),e.deactivate();else{const i=t.querySelectorAll("button[type=button], input:not([type=hidden], [type=reset], [type=submit]), textarea");for(const[,t]of i.entries())null===t.getAttribute("required")&&"true"!==t.getAttribute("data-required")||(t.id===e.activatorButtonEl.id?V(t,!1):(t.setAttribute("data-update-validation-on-input","true"),V(t)))}}}(t,i,n).catch((t=>console.error(t)))})),t.querySelectorAll("fieldset:disabled").forEach((t=>t.removeAttribute("disabled"))),t.classList.remove("has-overlay")}!function(){document.documentElement.classList.replace("js-disabled","js-enabled"),document.body.addEventListener("mousedown",(()=>document.body.classList.add("using-mouse"))),document.body.addEventListener("keydown",(()=>document.body.classList.remove("using-mouse")));try{const t=document.querySelector("#viktor-properties-typeit");t&&new P(t,{speed:80,deleteSpeed:40,loop:!0}).type("Likes technlo",{delay:500}).move(-2,{delay:350}).type("o",{delay:300}).move(2,{delay:400}).type("gy ...",{delay:1500}).move(-3,{delay:333}).delete(void 0,{delay:900}).move(3,{delay:450}).type(" and cars",{delay:1650}).delete(4,{delay:900}).type("photography",{delay:1800}).delete(15,{delay:900}).type("but also goodfood",{delay:300}).move(-4,{delay:350}).type(" ",{delay:250}).move(4,{delay:1450}).delete(9,{delay:900}).type("music",{delay:1600}).delete(14,{delay:900}).type("and nature",{delay:1400}).delete(void 0,{delay:900}).go()}catch(t){console.error(t)}try{const t=document.querySelector("#contact-form");t&&J(t)}catch(t){console.error(t)}}();